<!DOCTYPE html>
<html>
<!--Author: Curt Falconi-->

<head>
	<meta property="og:title" content="C&I Capstone Group 2 Project">
	<meta property="og:image" content="https://i.imgur.com/b7Ocmle.png">
	<meta name="theme-color" content="#0082A7">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&I Capstone Database</title>
	<link rel="icon" href="https://i.imgur.com/b7Ocmle.png">
	<link rel="stylesheet" type="text/css" href="../CSS/apistyle1.css">
	<h1>Lookup Movie ID</h1>
	<label>Movie ID:</label>
	<input type="text" id="movie_id" name="movie_id">
	<input type="submit" onclick="lookupMovie()" value="Submit">
	<br><br>
	<h1>Lookup and Submit Movie</h1>
	<label>Movie Title:</label>
	<input type="text" id="movie_title" name="movie_title">
	<input type="submit" onclick="lookupTitle()" value="Submit">
	<br><br>
	<h1>Submit Movie</h1>
	<label>Movie ID:</label>
	<input type="text" id="new_movie_id" name="new_movie_id">
	<label>Title:</label>
	<input type="text" id="title" name="title">
	<label>Trailer URL:</label>
	<input type="text" id="trailer_url" name="trailer_url">
	<input type="submit" onclick="postMovie()" value="Submit">
	<br>
	<iframe id="player" width="560" height="315" frameborder="0"
		allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
		allowfullscreen></iframe>
	<img id="poster" />
</head>

<body>
	<div class="raw">
		<p id="output">

		</p>
	</div>


	<script>
		function showVideo(trailer_url, img) {
			var player = document.getElementById("player");
			var poster = document.getElementById("poster");

			player.src = trailer_url;
			poster.src = img;
		}

		function lookupTitle() {
			var request = new XMLHttpRequest();
			var title = document.getElementById("movie_title").value;

			request.open('GET', 'http://3.208.10.4:3000/search?movie_title=' + title, true);

			request.onload = function () {
				console.log(this.response)
				var obj = JSON.parse(this.response);

				if (obj.youtube.items.length > 0 && obj.imdb.results.length > 0 && obj.tmdb.results.length > 0) {
					var youtube = obj.youtube.items[0];
					var trailer_url = 'https://www.youtube.com/watch?v=' + youtube.id.videoId;
					var postRequest = new XMLHttpRequest();
					var imdb = obj.imdb.results[0];
					var tmdb = obj.tmdb.results[0];
					var poster_url = 'https://image.tmdb.org/t/p/w220_and_h330_face' + tmdb.poster_path;
					var query_string = 'http://3.208.10.4:3000/movie?movie_id=' + movie_id + '&title=' + title + '&trailer_url=' + trailer_url + '&description=' +
						tmdb.description + '&poster_url=' + poster_url

					postRequest.open('POST', query_string, true)

					postRequest.onload = function () {
						document.getElementById("output").innerHTML = this.response + " Movie ID: " + imdb.id;
						showVideo('https://www.youtube.com/embed/' + youtube.id.videoId, tmdb.image);
					}

					postRequest.send();
				}
			}

			request.send();
		}

		function lookupMovie() {

			var request = new XMLHttpRequest()
			var movie_id = document.getElementById("movie_id").value;

			request.open('GET', 'http://3.208.10.4:3000/movie?movie_id=' + movie_id, true)

			request.onload = function () {
				var parsed = JSON.parse(this.response);

				document.getElementById("output").innerHTML = this.response;
				showVideo(parsed.Item.trailer_url.replace('/watch?v=', '/embed/'));
			}

			request.send()
		}

		function postMovie() {
			var request = new XMLHttpRequest()
			var movie_id = document.getElementById("new_movie_id").value;
			var title = document.getElementById("title").value;
			var trailer_url = document.getElementById("trailer_url").value;
			var query_string = 'http://3.208.10.4:3000/movie?movie_id=' + movie_id + '&title=' + title + '&trailer_url=' + trailer_url

			request.open('POST', query_string, true)


			request.onload = function () {
				document.getElementById("output").innerHTML = this.response;
			}
			document.getElementById("output").innerHTML = query_string;

			request.send()
		}

	</script>
</body>

</html>